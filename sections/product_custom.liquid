{% schema %}
{
  "name": "Product custom",
  "settings": [
    {
      "type": "richtext",
      "id": "disclamer_text",
      "label": "Descrição do disclamer"
    }
  ],
  "blocks": [
    {
      "type": "coupon",
      "name": "Oferta do Produto",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Título do bloco"
        },
        {
          "type": "color",
          "id": "background_color",
          "label": "Cor de fundo do bloco"
        },
        {
          "type": "text",
          "id": "selected_tags",
          "label": "Selecionar tags",
          "info": "Separe as tags por vírgula e com o texto exatamente igual. E.g: 'SHOP,Soria Natural'"
        },
        {
          "type": "richtext",
          "id": "selected_title",
          "label": "Título da oferta"
        },
        {
          "type": "richtext",
          "id": "selected_description",
          "label": "Descrição da oferta"
        },
        {
          "type": "text",
          "id": "selected_modal_description",
          "label": "Descrição da informação adicional"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product page",
      "category": "product"
    }
  ]
}
{% endschema %}

{% assign product_images = product.images %}
{% assign current_image = product_images.first %}

<script>
  const fullfillDeliveryText = (dateEls, timeEls) => {
    const now = new Date();
    const deliveryDate = new Date(now);
    if (now.getHours() >= 16) {
      deliveryDate.setDate(deliveryDate.getDate() + 1);
    }

    const weekdayRaw = deliveryDate.toLocaleDateString('pt-PT', { weekday: 'long' });
    const weekday = weekdayRaw[0].toUpperCase() + weekdayRaw.slice(1);

    dateEls.forEach((el) => {
      el.textContent = weekday;
    });

    const target = new Date(deliveryDate);
    target.setHours(16, 0, 0, 0);
    let diffMs = Math.max(0, target - now);
    const hours = Math.floor(diffMs / 3_600_000);
    const minutes = Math.floor((diffMs % 3_600_000) / 60_000);

    const parts = [];
    if (hours > 0) parts.push(`${hours} h`);
    if (minutes > 0) parts.push(`${minutes} min`);
    const diffText = parts.join(' ') || '0 min';

    timeEls.forEach((el) => {
      el.textContent = diffText;
    });
  };
</script>

<style>
  #modal_campaign_details {
    display: none;
    grid-template-rows: repeat(2, max-content);
    padding: 2rem 3rem 2rem 2rem;
    background-color: white;
    border-radius: 1rem;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1003;
    width: auto;
    max-width: 90%;
    overflow: auto;
  }

  #modal_campaign_details > svg {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 20px;
    height: 20px;
    cursor: pointer;
    justify-self: right;
  }

  #modal_campaign_details > div {
    display: grid;
    grid-template-columns: max-content 1fr;
    gap: 1rem;
  }

  #modal_campaign_details > div > svg {
    width: 30px;
    height: 30px;
  }

  #modal_campaign_details > div > div {
    display: grid;
    grid-template-rows: repeat(2, max-content);
    gap: 0.5rem;
  }

  #modal_campaign_details > div > div > h1 {
    margin: 0;
    font-size: 17px;
    line-height: normal;
  }

  #modal_campaign_details > div > div > span {
    margin: 0;
    font-size: 14px;
    max-width: 30rem;
    line-height: normal;
  }

  #add_to_cart_btn_container_mobile {
    background-color: white;
    padding: 1rem;
    z-index: 11;
  }

  .netreviews_review_rate_and_stars {
    margin: 0 !important;
  }

  #custom_wrapper_content {
    display: grid;
    grid-auto-rows: max-content;
    grid-auto-flow: row;
    gap: 0.5rem;
  }

  .delivery_wrapper_custom {
    display: grid;
    grid-auto-flow: column;
    grid-auto-columns: max-content;
    align-items: center;
    gap: 1rem;
    margin: 0.5rem 0;
  }

  @media screen and (max-width: 1599px) and (min-width: 1000px) {
    #product_page_custom > #product_page_breadcrumbs > li > a {
      font-size: 0.75rem !important;
    }

    .img_favorite_custom > img {
      max-width: 300px !important;
    }

    .img_favorite_custom > div {
      height: 300px !important;
    }

    #product_page_custom > section > div > div > div > div > h1,
    #price_custom_modal > h1,
    #product_page_custom > section > div > ul > li > h2 {
      font-size: 20px !important;
    }

    span,
    #price_percentage_modal > #percentage_custom,
    #price_percentage_modal > span,
    #oferta_product_custom > li > span,
    .delivery_wrapper_custom > span {
      font-size: 0.75rem !important;
    }

    #indicacoes_list_custom > ul > li,
    #oferta_product_custom > li > h1,
    #price_custom_modal > span,
    .modal_info_custom > h3 {
      font-size: 14px !important;
    }

    #product_page_custom > section > div > ul > li > span,
    #product_page_custom > section > div > ul > li > p,
    #price_quantity_modal > button,
    #price_quantity_modal > a,
    .modal_info_custom > span {
      font-size: 0.813rem !important;
    }
  }

  .delivery_wrapper_custom > img {
    width: 20px;
    height: 20px;
  }

  .delivery_wrapper_custom > span {
    font-size: 14px;
    width: 20rem;
  }

  #get_campaign_details {
    font-size: 14px;
    text-decoration: underline;
    cursor: pointer;
    width: max-content;
    font-weight: 700;
  }

  .modal_info_custom {
    position: absolute;
    width: 18rem;
    background-color: #333;
    padding: 1rem;
    border-radius: 0.65rem;
    display: none;
    grid-auto-rows: max-content;
    grid-auto-flow: row;
    color: white;
    gap: 0.5rem;
    left: 0;
    bottom: 2rem;
    z-index: 10;
    overflow: auto;
    max-height: 114px;
  }

  .modal_info_custom > h3 {
    font-size: 1.125rem;
    margin: 0;
  }

  .modal_info_custom > div {
    height: 1px;
    width: 100%;
    background-color: white;
  }
  #indicacoes_list_custom > h3 {
    font-size: 1rem;
    color: #258439;
    margin: 0;
    padding: 0;
  }

  #indicacoes_list_custom > ul {
    display: grid;
    grid-auto-rows: max-content;
    grid-auto-flow: row;
    gap: 0.5rem;
    margin-left: 0.5rem;
    list-style: none;
    padding: 0;
  }

  #indicacoes_list_custom > ul > li {
    position: relative;
    padding-left: 1.75rem;
    font-weight: 600;
    color: black;
    font-size: 1rem;
    line-height: normal;
  }

  #indicacoes_list_custom > ul > li::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 0.8rem;
    height: 0.8rem;
    background-image: url('{{ "check-icon.svg" | asset_url }}');
    background-size: cover;
    background-repeat: no-repeat;
  }

  #product_page_custom {
    display: grid;
    grid-template-rows: repeat(3, max-content);
    gap: 1rem;
    margin: 2rem var(--desktop-container-gutter);
  }

  #product_page_custom_mobile {
    display: none;
    grid-auto-flow: row;
    grid-auto-rows: max-content;
    gap: 1rem;
    margin: 1rem var(--mobile-container-gutter);
  }

  #related_products_custom {
    display: grid;
    grid-template-rows: repeat(2, max-content);
    gap: 0.5rem;
    margin-top: 1rem;
  }

  #related_products_custom > h1 {
    font-size: 1.75rem;
    font-weight: 700;
    margin: 0;
  }

  #related_products_custom > ul {
    display: grid;
    grid-auto-flow: column;
    grid-auto-columns: max-content;
    gap: 0.35rem;
    overflow: hidden;
    list-style-type: none;
  }

  #related_products_custom > ul > li {
    display: grid;
  }

  #related_products_custom > ul > li > section {
    width: 350px;
  }

  #related_products_custom > ul > li > svg {
    position: absolute;
    padding: 0.5rem;
    background-color: #258439;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    cursor: pointer;
    align-self: center;
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.15s ease;
  }

  #related_products_custom > ul:hover > li > svg {
    visibility: visible;
    opacity: 1;
    z-index: 10;
  }

  #related_products_custom > ul > li > #right-button-svg {
    right: var(--desktop-container-gutter);
  }

  #product_page_custom > #product_page_breadcrumbs {
    display: grid;
    grid-auto-columns: max-content;
    grid-auto-flow: column;
    gap: 0.25rem;
    list-style-type: none;
    margin-bottom: 1rem;
    font-weight: 600;
  }

  #product_page_custom_mobile > #product_page_breadcrumbs {
    display: grid;
    grid-auto-columns: max-content;
    grid-auto-flow: column;
    gap: 0.25rem;
    list-style-type: none;
    max-width: calc(100vw - 20px);
    font-weight: 600;
  }

  #product_page_custom > #product_page_breadcrumbs > li {
    display: grid;
    font-weight: bold !important;
  }

  #product_page_custom > #product_page_breadcrumbs > li > a {
    font-size: 14px;
    text-decoration: none;
    cursor: pointer;
    font-weight: bold !important;
  }

  #product_page_custom > #product_page_breadcrumbs > li > a:hover {
    text-decoration: underline;
  }

  #product_page_custom > #product_page_breadcrumbs > li > #current_page_custom {
    color: #258439;
    font-size: 14px;
  }

  #product_page_custom > section {
    display: grid;
    grid-template-columns: 1fr max-content;
    gap: 2rem;
  }

  #product_page_custom_mobile > #product_name_custom {
    display: grid;
    grid-auto-rows: max-content;
    grid-auto-flow: row;
    gap: 0.25rem;
    color: #258439;
  }

  #product_name_custom > .link_collection {
    width: max-content;
    text-decoration: underline;
    text-decoration-thickness: 2px;
    font-size: 13px;
  }

  #product_page_custom_mobile > #product_name_custom > h1 {
    margin: 0;
    font-size: 1.125rem;
  }

  #product_page_custom > section > div > div > div > div > .link_collection {
    font-size: 1rem;
    width: max-content;
    text-decoration: underline;
    text-decoration-thickness: 2px;
  }

  #product_page_custom > section > div {
    display: grid;
    grid-template-rows: repeat(2, max-content);
    gap: 2rem;
  }

  #product_page_custom > section > div > div {
    display: grid;
    grid-template-columns: max-content 1fr;
    gap: 2rem;
  }

  #product_page_custom > section > div > div > div {
    display: grid;
    grid-template-rows: repeat(2, max-content);
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }

  #product_page_custom > section > div > div > div > div {
    display: grid;
    grid-auto-rows: max-content;
    grid-auto-flow: row;
    gap: 0.5rem;
    color: #258439;
    min-width: 0;
  }

  #product_page_custom > section > div > div > div > div > h1 {
    margin: 0;
    font-size: 1.5rem;
    line-height: normal;
    overflow-wrap: break-word;
    white-space: normal;
  }

  #product_page_custom > section > div > div > div > div > .link_custom {
    text-decoration: none;
    color: currentColor;
    line-height: normal;
    width: max-content;
  }

  #product_page_custom > section > div > ul,
  #product_page_custom_mobile > #product_description_custom {
    display: grid;
    grid-auto-rows: max-content;
    grid-auto-flow: row;
    list-style-type: none;
    gap: 1rem;
  }

  #product_page_custom > section > div > ul > li,
  #product_page_custom_mobile > #product_description_custom > li {
    display: grid;
    grid-template-rows: repeat(2, max-content);
    gap: 0.5rem;
    font-weight: 600;
  }

  #product_page_custom > section > div > ul > li > h2 {
    border-bottom: 2px solid #258439;
    margin: 0;
    font-size: 1.5rem;
    line-height: normal;
    color: #258439;
  }

  #product_page_custom_mobile > #product_description_custom > li > h2 {
    border-bottom: 2px solid #258439;
    margin: 0;
    font-size: 16px;
    line-height: normal;
    color: #258439;
  }

  #product_page_custom_mobile > #product_description_custom > li > span {
    line-height: 21px;
  }

  #product_page_custom > section > aside {
    display: grid;
    grid-auto-rows: max-content;
    grid-auto-flow: row;
    padding: 1rem 1.5rem;
    gap: 0.8rem;
    box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
    border-radius: 0.65rem;
    position: sticky;
    height: max-content;
    top: 100px;
    max-height: calc(100vh - 20px);
    overflow-y: auto;
    font-weight: 600;
    min-width: 26rem;
  }

  #price_custom_modal_wrapper {
    display: grid;
    grid-template-columns: repeat(2, max-content);
    gap: 1rem;
    justify-content: space-between;
  }

  #biopoints_wrapper {
    display: grid;
    grid-template-columns: repeat(2, max-content);
    gap: 0.5rem;
    align-items: center;
  }

  #price_custom_modal,
  #price_percentage_modal,
  #product_page_custom_mobile > aside > #custom_wrapper_content > #price_custom_modal,
  #product_page_custom_mobile > #custom_wrapper_content > aside > #price_percentage_modal {
    display: grid;
    grid-template-columns: repeat(2, max-content);
    gap: 1rem;
    align-items: center;
  }

  #price_percentage_modal {
    justify-content: space-between;
  }

  #price_custom_modal > h1 {
    margin: 0;
    font-size: 1.75rem;
    line-height: normal;
    color: #258439;
    font-weight: bolder !important;
  }

  #product_page_custom_mobile > aside > #custom_wrapper_content > #price_custom_modal > h1 {
    font-size: 1.313rem;
    line-height: normal;
    color: #258439;
    margin: 0;
  }

  #price_custom_modal > span,
  #biopoints_wrapper > span {
    font-weight: bold !important;
    line-height: normal;
  }

  #price_custom_modal > span {
    text-decoration: line-through;
    font-size: 1.125rem;
  }

  #biopoints_wrapper > span {
    font-size: 1.05rem;
  }

  #product_page_custom_mobile > aside > #custom_wrapper_content > #price_custom_modal > span {
    text-decoration: line-through;
    line-height: normal;
    font-size: 1rem;
  }

  #price_percentage_modal > #percentage_custom,
  #product_page_custom_mobile > #custom_wrapper_content > #price_percentage_modal > #percentage_custom {
    background-color: #ffbb12;
    color: black;
    padding: 0 0.75rem;
    border-radius: 2.5rem;
    font-size: 1rem !important;
    font-weight: bold;
  }

  #price_percentage_modal > #percentage_custom,
  #price_percentage_modal > span,
  #product_page_custom_mobile > #custom_wrapper_content > #price_percentage_modal > #percentage_custom,
  #product_page_custom_mobile > #custom_wrapper_content > #price_percentage_modal > span {
    font-size: 13px;
  }

  #product_page_custom_mobile > aside {
    display: grid;
    grid-auto-rows: max-content;
    grid-auto-flow: row;
    padding: 1rem;
    gap: 1rem;
    box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
    border-radius: 0.5rem;
    overflow-y: auto;
  }

  #oferta_product_custom,
  #product_page_custom_mobile > aside > #oferta_product_custom {
    display: grid;
    grid-auto-rows: max-content;
    grid-auto-flow: row;
    gap: 0.5rem;
    list-style-type: none;
    padding: 0;
    margin: 0;
  }

  #add_to_cart_btn_container_mobile > a {
    display: grid;
  }

  #oferta_product_custom > li,
  #product_page_custom_mobile > aside > #oferta_product_custom > li {
    padding: 0.8rem 1.5rem;
    border-radius: 1.25rem;
    position: relative;
    display: grid;
    grid-template-rows: repeat(2, max-content);
    gap: 0.25rem;
    max-width: 26rem;
  }

  #oferta_product_custom > li > h1,
  #product_page_custom_mobile > aside > #oferta_product_custom > li > h1 {
    margin: 0;
    font-weight: 900;
    font-size: 1rem;
  }

  #oferta_product_custom > li > p,
  #product_page_custom_mobile > aside > #oferta_product_custom > li > p {
    font-size: 13px;
    line-height: normal;
    white-space: normal;
  }

  #price_quantity_modal > a,
  #price_quantity_modal > a,
  #price_quantity_modal > button,
  #price_quantity_modal > button,
  #add_to_cart_btn_container_mobile > button,
  #add_to_cart_btn_container_mobile > a {
    display: grid;
    grid-template-columns: repeat(2, max-content);
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
  }

  #price_quantity_modal,
  #price_quantity_modal {
    display: grid;
  }

  #quantity-controls,
  #price_quantity_modal > div {
    display: grid;
    grid-template-columns: repeat(3, max-content);
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    border-radius: 0.55rem;
    align-items: center;
    font-weight: 700;
    width: max-content;
    min-width: 120px;
    justify-content: space-between;
  }

  #quantity-controls > *,
  #price_quantity_modal > div > * {
    border: none;
    background-color: transparent;
    text-align: center;
  }

  #quantity-controls > svg {
    border-radius: 50%;
    padding: 0.5rem;
    width: 1.75rem;
    height: 1.75rem;
  }

  #quantity-controls > input {
    font-size: 1rem;
  }

  #quantity-controls > input:focus,
  #price_quantity_modal > div > input:focus {
    outline: none;
  }

  #quantity-controls > input::-webkit-outer-spin-button,
  #price_quantity_modal > div > input::-webkit-outer-spin-button,
  input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  #quantity-controls > input[type='number'],
  #price_quantity_modal > div > input[type='number'] {
    -moz-appearance: textfield;
  }

  #add-to-cart,
  #price_quantity_modal > button,
  #price_quantity_modal > a,
  #price_quantity_modal > a,
  #add_to_cart_btn_container_mobile > button,
  #add_to_cart_btn_container_mobile > a {
    padding: 0.675rem 1rem;
    border: none;
    border-radius: 0.65rem;
    color: white;
    text-align: center;
    font-size: 15px;
    transition: all 0.15s ease;
  }

  #add-to-cart,
  #price_quantity_modal > button,
  #add_to_cart_btn_container_mobile > button,
  #add_to_cart_btn_container_mobile > a {
    background-color: #258439;
  }

  #add_to_cart_btn_container_mobile > button,
  #add_to_cart_btn_container_mobile > a {
    width: 100%;
  }

  #add-to-cart:hover,
  #price_quantity_modal > button:hover,
  #add_to_cart_btn_container_mobile > button:hover,
  #add_to_cart_btn_container_mobile > a:hover {
    background-color: #ffbb12;
    color: black;
  }

  #related_products_custom,
  .NETREVIEWS_PRODUCT_REVIEWS {
    margin: 2rem var(--desktop-container-gutter);
  }

  @media screen and (min-width: 1499px) {
    #product_page_custom,
    #related_products_custom,
    .NETREVIEWS_PRODUCT_REVIEWS {
      margin: 2rem 9vw;
    }

    #related_products_custom > ul > li > #right-button-svg {
      right: 9vw;
    }
  }

  @media screen and (min-width: 2559px) {
    #product_page_custom,
    #related_products_custom,
    .NETREVIEWS_PRODUCT_REVIEWS {
      margin: 2rem 18vw;
    }

    #related_products_custom > ul > li > #right-button-svg {
      right: 18vw;
    }
  }

  @media screen and (max-width: 1599px) {
    #product_page_custom > section > aside,
    #oferta_product_custom > li {
      min-width: 20rem;
    }
  }

  @media screen and (max-width: 1499px) {
    #product_page_custom > section > div > div {
      gap: 1rem;
    }

    #related_products_custom > ul > li > section {
      width: 300px;
    }
  }

  @media screen and (max-width: 1200px) and (min-width: 1000px) {
    #product_page_custom > section > aside {
      padding: 1rem;
    }

    img {
      width: 250px;
      justify-self: center;
    }

    #oferta_product_custom > li {
      width: 20rem;
    }
  }

  #modal_overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    z-index: 1001;
    display: none;
  }

  @media screen and (max-width: 360px) {
    #modal_campaign_details > div > svg,
    #modal_campaign_details > svg {
      width: 1.125rem;
      height: 1.125rem;
    }

    #modal_campaign_details > div > div > h1 {
      font-size: 14px;
    }

    #modal_campaign_details > div > div > span {
      font-size: 0.75rem;
    }
  }

  .img_favorite_custom {
    display: grid;
    grid-template-columns: max-content 1fr;
    gap: 1rem;
  }

  .img_favorite_custom > div {
    display: grid;
    grid-auto-flow: row;
    grid-auto-rows: max-content;
    overflow: auto;
    gap: 0.5rem;
    height: 500px;
  }

  .img_favorite_custom > div > img {
    width: 4rem;
    height: 4rem;
    padding: 0.5rem !important;
    cursor: pointer;
  }

  .img_favorite_custom > img,
  .img_favorite_custom > div > img {
    max-width: 500px;
    padding: 1rem;
    border: 1px solid #258439;
    border-radius: 0.65rem;
  }

  @media screen and (max-width: 1000px) {
    #product_page_custom > section > aside,
    #oferta_product_custom > li {
      min-width: auto;
    }

    .img_favorite_custom > img,
    .img_favorite_custom > div > img {
      max-width: 100% !important;
    }

    .img_favorite_custom > div {
      height: 100% !important;
      width: calc(100dvw - var(--mobile-container-gutter) * 2);
    }

    .img_favorite_custom {
      grid-template-columns: 1fr;
      grid-template-rows: repeat(2, max-content);
      justify-items: center;
    }

    .img_favorite_custom > div {
      grid-auto-flow: column;
      grid-auto-columns: max-content;
    }

    #product_page_custom {
      display: none;
    }

    #modal_campaign_details {
      display: grid;
      top: unset;
      bottom: 0;
      padding: 2rem 2rem 1rem 1rem;
      border-radius: 1rem 1rem 0 0;
      max-width: unset;
      max-height: 90%;
      left: unset;
      transform: translateY(100%);
      transition: all 0.3s ease;
    }

    #modal_campaign_details > div > div > span {
      max-width: unset !important;
    }

    #related_products_custom > ul {
      overflow: auto;
    }

    #related_products_custom > ul > li > section {
      width: 250px;
    }

    #related_products_custom > h1 {
      font-size: 1rem;
    }

    #related_products_custom,
    .NETREVIEWS_PRODUCT_REVIEWS {
      margin: 1rem var(--mobile-container-gutter);
    }

    #product_page_custom_mobile {
      display: grid;
    }

    .modal_info_custom {
      width: 14rem;
    }

    .modal_info_custom > h3 {
      font-size: 1rem;
    }

    .delivery_wrapper_custom > img {
      width: 1.125rem;
      height: 1.125rem;
    }
  }

  @media screen and (max-width: 370px) {
    .delivery_wrapper_custom > span {
      width: 14rem;
    }

    #price_percentage_modal > #percentage_custom,
    #price_percentage_modal > span {
      width: max-content;
    }

    #price_percentage_modal > #percentage_custom,
    #price_percentage_modal > span,
    #product_page_custom_mobile > #custom_wrapper_content > #price_percentage_modal > #percentage_custom,
    #product_page_custom_mobile > #custom_wrapper_content > #price_percentage_modal > span,
    #price_quantity_modal > a,
    #add_to_cart_btn_container_mobile > a,
    #price_quantity_modal > button,
    #add_to_cart_btn_container_mobile > button {
      font-size: 0.75rem;
    }

    #price_percentage_modal,
    .quantity_stock_container,
    .product_delivery_time {
      grid-template-rows: repeat(2, max-content);
      grid-template-columns: max-content !important;
    }
  }

  .discount_badge {
    display: grid;
    border-radius: 2.5rem;
    border: 1px solid #ffbb12;
    padding: 0.65rem;
    width: 100%;
  }

  .discount_badge > span {
    text-align: center;
    color: #258439;
    font-size: 13px;
    font-weight: 700;
    line-height: normal;
  }

  .title_block_container {
    display: grid;
    grid-template-columns: repeat(2, max-content);
    justify-content: space-between;
    gap: 1rem;
    align-items: center;
  }

  .title_block_container > h1 {
    margin: 0;
    padding: 0;
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
  }

  .quantity_stock_container {
    display: grid;
    grid-template-columns: repeat(2, max-content);
    gap: 1rem;
    align-items: center;
  }

  .quantity_stock_container > .stock_container {
    display: grid;
    grid-template-columns: repeat(2, max-content);
    gap: 0.5rem;
    align-items: center;
  }

  .quantity_stock_container > .stock_container > span {
    font-weight: bold;
    font-size: 1rem;
  }

  .product_delivery_time {
    display: grid;
    grid-template-columns: repeat(2, max-content);
    gap: 1rem;
  }

  .product_delivery_time > div {
    display: grid;
    grid-auto-rows: max-content;
    grid-autow-flow: row;
  }

  .product_delivery_time > div > span {
    line-height: normal;
  }

  .product_delivery_time > div > span > b {
    color: #258439;
    font-weight: bold;
  }

  .spinner_date {
    display: inline-block;
    width: 1em;
    height: 1em;
    border: 2px solid rgba(0, 0, 0, 0.1);
    border-top-color: rgba(0, 0, 0, 0.5);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    vertical-align: text-bottom;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }
</style>

{% assign has_tag = false %}

{% for block in section.blocks %}
  {% assign array_tags = block.settings.selected_tags | split: ',' %}
  {% for tag in array_tags %}
    {% if product.tags contains tag %}
      {% assign has_tag = true %}
    {% endif %}
  {% endfor %}
{% endfor %}

{% assign vendor_handle = product.vendor | handleize %}
{% assign vendor_collection = blank %}

{% for collection in collections %}
  {% if collection.handle == vendor_handle %}
    {% assign vendor_collection = collection %}
  {% endif %}
{% endfor %}

{% assign descricao = product.description | split: '[' | first %}
{% assign indicacoes = product.description | split: '[Indicações]' | slice: 1, 1 %}
{% assign advertencias = product.description | split: '[Advertências]' | slice: 1, 1 %}
{% assign composicao_nutricional = product.description | split: '[Composição Nutricional]' | slice: 1, 1 %}
{% assign ingredientes = product.description | split: '[Ingredientes]' | slice: 1, 1 %}
{% assign utilizacao = product.description | split: '[Modo de Utilização]' | slice: 1, 1 %}

<main id="product_page_custom">
  <ul id="product_page_breadcrumbs">
    <li>
      <a href="/">Página inicial</a>
    </li>

    <li>
      <span>></span>
    </li>

    {% if vendor_collection != blank %}
      <li>
        <a class="link_collection" href="{{ vendor_collection.url }}">
          {{- product.vendor -}}
        </a>
      </li>

      <li>
        <span>></span>
      </li>
    {% else %}
      {% if product.collections.size > 0 %}
        <li>
          <a class="link_collection" href="/collections/{{ product.collections.first.handle }}">
            {{- product.collections.first.title -}}
          </a>
        </li>

        <li>
          <span>></span>
        </li>
      {% endif %}
    {% endif %}

    <li>
      <span id="current_page_custom">{{ product.title }}</span>
    </li>
  </ul>

  <section>
    <div>
      <div>
        <section class="img_favorite_custom">
          {% unless product_images.size < 2 %}
            <div>
              {% for image in product_images %}
                <img
                  src="{{ image | img_url: 'master' }}"
                  alt="{{ product.title }} - imagem {{ forloop.index }}"
                  loading="eager"
                  width="auto"
                  height="auto"
                  class="thumbnail-product"
                >
              {% endfor %}
            </div>
          {% endunless %}

          <img
            src="{{ current_image | img_url: 'master' }}"
            alt="{{ product.title }} - imagem principal"
            loading="eager"
            width="auto"
            height="auto"
            id="main-image-product"
          >
        </section>

        <script>
          document.addEventListener('DOMContentLoaded', function () {
            const thumbnails = document.querySelectorAll('.img_favorite_custom .thumbnail-product');
            const mainImage = document.getElementById('main-image-product');

            function setAsMain(event) {
              const novaSrc = event.currentTarget.getAttribute('src');
              mainImage.setAttribute('src', novaSrc);

              const novoAlt = event.currentTarget.getAttribute('alt');
              mainImage.setAttribute('alt', novoAlt);
            }

            thumbnails.forEach(function (thumb) {
              thumb.addEventListener('click', setAsMain);
              thumb.addEventListener('mouseenter', setAsMain);
            });
          });
        </script>

        <div>
          <div>
            <h1>{{ product.title }}</h1>

            {% if vendor_collection != blank %}
              <a class="link_collection" href="{{ vendor_collection.url }}">
                {{- product.vendor -}}
              </a>
            {% else %}
              {% if product.collections.size > 0 %}
                <a class="link_collection" href="/collections/{{ product.collections.first.handle }}">
                  {{- product.collections.first.title -}}
                </a>
              {% endif %}
            {% endif %}

            <a
              href="#custom_reviews_list"
              class="NETREVIEWS_PRODUCT_STARS"
              data-product-id="{{ product.id }}"
            ></a>
          </div>

          <div id="indicacoes_list_custom">
            <h3>Indicações</h3>

            {{ indicacoes }}
          </div>
        </div>
      </div>

      <ul>
        {% if descricao != blank %}
          <li>
            <h2>Descrição</h2>

            <span>{{ descricao }}</span>
          </li>
        {% endif %}

        {% if utilizacao != blank %}
          <li>
            <h2>Modo de Utilização</h2>

            <span>{{ utilizacao }}</span>
          </li>
        {% endif %}

        {% if composicao_nutricional != blank %}
          <li>
            <h2>Composição Nutricional</h2>

            <span>{{ composicao_nutricional }}</span>
          </li>
        {% endif %}

        {% if ingredientes != blank %}
          <li>
            <h2>Ingredientes</h2>

            <span>{{ ingredientes }}</span>
          </li>
        {% endif %}

        {% if advertencias != blank %}
          <li>
            <h2>Advertências</h2>

            <span>{{ advertencias }}</span>
          </li>
        {% endif %}

        <li>
          <h2>Disclaimer</h2>

          {{ section.settings.disclamer_text }}
        </li>
      </ul>
    </div>

    <aside>
      <div id="price_custom_modal_wrapper">
        <div id="price_custom_modal">
          <h1>{{ product.price | money }}</h1>

          {% if product.compare_at_price > 0 %}
            <span>{{ product.compare_at_price | money }}</span>
          {% endif %}
        </div>

        <a href="#ba-loyalty-home" id="biopoints_wrapper">
          <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M5.63608 14.6456L9.82683 10.4549L5.63608 6.26413C5.07475 5.73633 4.32999 5.4478 3.55959 5.45966C2.78919 5.47151 2.05367 5.78283 1.50885 6.32765C0.964028 6.87247 0.652713 7.60799 0.640855 8.37839C0.628998 9.14879 0.917531 9.89355 1.44533 10.4549C1.15609 10.7268 0.924423 11.0541 0.764068 11.4173C0.603712 11.7805 0.517935 12.1722 0.511826 12.5691C0.505716 12.9661 0.579398 13.3603 0.728501 13.7282C0.877603 14.0962 1.09909 14.4304 1.37982 14.7111C1.66055 14.9919 1.9948 15.2134 2.36275 15.3625C2.7307 15.5116 3.12485 15.5852 3.52181 15.5791C3.91878 15.573 4.31047 15.4872 4.67366 15.3269C5.03684 15.1665 5.36412 14.9349 5.63608 14.6456Z" fill="#258439"/>
            <path d="M10.5129 11.1595L6.32216 15.3502C5.79436 15.9116 5.50583 16.6563 5.51769 17.4267C5.52954 18.1971 5.84086 18.9326 6.38568 19.4775C6.9305 20.0223 7.66602 20.3336 8.43642 20.3455C9.20682 20.3573 9.95158 20.0688 10.5129 19.541C10.7849 19.8302 11.1121 20.0619 11.4753 20.2222C11.8385 20.3826 12.2302 20.4684 12.6272 20.4745C13.0241 20.4806 13.4183 20.4069 13.7862 20.2578C14.1542 20.1087 14.4884 19.8872 14.7692 19.6065C15.0499 19.3258 15.2714 18.9915 15.4205 18.6236C15.5696 18.2556 15.6433 17.8615 15.6372 17.4645C15.631 17.0675 15.5453 16.6758 15.3849 16.3127C15.2246 15.9495 14.9929 15.6222 14.7037 15.3502L10.5129 11.1595Z" fill="#258439"/>
            <path d="M19.5766 6.2611C19.0183 5.7102 18.2655 5.40132 17.4812 5.40132C16.6969 5.40132 15.9441 5.7102 15.3858 6.2611L11.1951 10.4518L15.3858 14.6426C15.6578 14.9318 15.9851 15.1635 16.3482 15.3239C16.7114 15.4842 17.1031 15.57 17.5001 15.5761C17.8971 15.5822 18.2912 15.5085 18.6591 15.3594C19.0271 15.2103 19.3614 14.9888 19.6421 14.7081C19.9228 14.4274 20.1443 14.0931 20.2934 13.7252C20.4425 13.3572 20.5162 12.9631 20.5101 12.5661C20.504 12.1691 20.4182 11.7775 20.2578 11.4143C20.0975 11.0511 19.8658 10.7238 19.5766 10.4518C20.1275 9.89357 20.4363 9.1408 20.4363 8.35647C20.4363 7.57215 20.1275 6.81938 19.5766 6.2611Z" fill="#258439"/>
            <path d="M14.7037 1.38498C14.1454 0.834085 13.3926 0.525208 12.6083 0.525208C11.824 0.525208 11.0712 0.834085 10.5129 1.38498C9.95158 0.857186 9.20682 0.568654 8.43642 0.580511C7.66602 0.592368 6.9305 0.903684 6.38568 1.4485C5.84086 1.99332 5.52954 2.72885 5.51769 3.49925C5.50583 4.26965 5.79436 5.0144 6.32216 5.57573L10.5129 9.76648L14.7037 5.57573C15.2546 5.01745 15.5634 4.26468 15.5634 3.48036C15.5634 2.69603 15.2546 1.94326 14.7037 1.38498Z" fill="#258439"/>
          </svg>

          <span>{{ product.price | money_without_currency | times: 5 }}</span>
        </a>
      </div>

      {%- assign units = product.metafields.PHC['Valor-Unidade'] | floor -%}
      {%- assign pvp = product.price -%}
      {%- assign pvp_per_unit = pvp | divided_by: units | money -%}

      {% if product.compare_at_price > product.price and product.compare_at_price > 0 %}
        <div id="price_percentage_modal">
          <span id="percentage_custom">
            -
            {{-
              product.compare_at_price
              | minus: product.price
              | times: 100.0
              | divided_by: product.compare_at_price
              | round
            -}}
            %</span
          >

          {% unless units == blank
            or product.metafields.PHC['Unidade-Plural'] == blank
            or product.metafields.PHC['Unidade-Singular'] == blank
          %}
            <span>
              {{- units }}
              {{ product.metafields.PHC['Unidade-Plural'] }} / €{{ pvp_per_unit | split: '€' }} por
              {{ product.metafields.PHC['Unidade-Singular'] -}}
            </span>
          {% endunless %}
        </div>
      {% endif %}

      {% if has_tag == true %}
        <div class="discount_badge">
          <span>Preços e campanhas exclusivas da loja online</span>
        </div>

        <ul id="oferta_product_custom">
          {% for block in section.blocks %}
            {% assign current_index = forloop.index %}
            {% assign array_tags = block.settings.selected_tags | split: ',' %}
            {% assign bg_color = block.settings.background_color %}

            {% if bg_color == blank %}
              {% assign idx_mod = current_index | modulo: 2 %}

              {% if idx_mod == 1 %}
                {% assign bg_color = '#ffbb12' %}
              {% else %}
                {% assign bg_color = '#c8e0cd' %}
              {% endif %}
            {% endif %}

            {% for tag in array_tags %}
              {% if product.tags contains tag %}
                <li style="background-color: {{ bg_color }};">
                  <div class="title_block_container">
                    <h1>{{ block.settings.selected_title }}</h1>

                    <svg
                      id="get_campaign_details"
                      index="{{ current_index }}"
                      width="21"
                      height="20"
                      viewBox="0 0 21 20"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path d="M9.23096 15H11.231V9H9.23096V15ZM10.231 7C10.5143 7 10.7518 6.90417 10.9435 6.7125C11.1351 6.52083 11.231 6.28333 11.231 6C11.231 5.71667 11.1351 5.47917 10.9435 5.2875C10.7518 5.09583 10.5143 5 10.231 5C9.94762 5 9.71012 5.09583 9.51846 5.2875C9.32679 5.47917 9.23096 5.71667 9.23096 6C9.23096 6.28333 9.32679 6.52083 9.51846 6.7125C9.71012 6.90417 9.94762 7 10.231 7ZM10.231 20C8.84762 20 7.54762 19.7375 6.33096 19.2125C5.11429 18.6875 4.05596 17.975 3.15596 17.075C2.25596 16.175 1.54346 15.1167 1.01846 13.9C0.493457 12.6833 0.230957 11.3833 0.230957 10C0.230957 8.61667 0.493457 7.31667 1.01846 6.1C1.54346 4.88333 2.25596 3.825 3.15596 2.925C4.05596 2.025 5.11429 1.3125 6.33096 0.7875C7.54762 0.2625 8.84762 0 10.231 0C11.6143 0 12.9143 0.2625 14.131 0.7875C15.3476 1.3125 16.406 2.025 17.306 2.925C18.206 3.825 18.9185 4.88333 19.4435 6.1C19.9685 7.31667 20.231 8.61667 20.231 10C20.231 11.3833 19.9685 12.6833 19.4435 13.9C18.9185 15.1167 18.206 16.175 17.306 17.075C16.406 17.975 15.3476 18.6875 14.131 19.2125C12.9143 19.7375 11.6143 20 10.231 20ZM10.231 18C12.4643 18 14.356 17.225 15.906 15.675C17.456 14.125 18.231 12.2333 18.231 10C18.231 7.76667 17.456 5.875 15.906 4.325C14.356 2.775 12.4643 2 10.231 2C7.99762 2 6.10596 2.775 4.55596 4.325C3.00596 5.875 2.23096 7.76667 2.23096 10C2.23096 12.2333 3.00596 14.125 4.55596 15.675C6.10596 17.225 7.99762 18 10.231 18Z" fill="#1C1B1F"/>
                    </svg>
                  </div>

                  {{- block.settings.selected_description -}}
                </li>
              {% endif %}
            {% endfor %}
          {% endfor %}
        </ul>
      {% endif %}

      <div class="quantity_stock_container">
        <div
          id="quantity-controls"
          style="border: 1px solid {% if product.variants.first.available == true %}#258439{% else %}#C0C5CA{% endif %};"
        >
          <svg
            id="decrease-quantity"
            width="12"
            height="2"
            viewBox="0 0 12 2"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            style="background-color: {% if product.variants.first.available == true %}#b7ffc1{% else %}#C0C5CA{% endif %}; {% if product.variants.first.available == true %}cursor: pointer{% else %}pointer-events: none{% endif %};"
          >
            <path d="M0.657471 1.97195V0.36084H11.9352V1.97195H0.657471Z" fill="{% if product.variants.first.available == true %}black{% else %}white{% endif %}"/>
          </svg>

          {% if product.variants.first.available == true %}
            <input
              type="number"
              id="product-quantity"
              value="1"
              min="1"
              max="16"
            >
          {% else %}
            <span style="color: #C0C5CA;">-</span>
          {% endif %}

          <svg
            id="increase-quantity"
            width="12"
            height="12"
            viewBox="0 0 12 12"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            style="background-color: {% if product.variants.first.available == true %}#b7ffc1{% else %}#C0C5CA{% endif %}; {% if product.variants.first.available == true %}cursor: pointer{% else %}pointer-events: none{% endif %};"
          >
            <path d="M5.34847 6.97179H0.515137V5.36068H5.34847V0.527344H6.95958V5.36068H11.7929V6.97179H6.95958V11.8051H5.34847V6.97179Z" fill="{% if product.variants.first.available == true %}black{% else %}white{% endif %}"/>
          </svg>
        </div>

        <div class="stock_container">
          <svg width="19" height="21" viewBox="0 0 19 21" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8.41602 17.925V11.075L2.41602 7.6V14.45L8.41602 17.925ZM10.416 17.925L16.416 14.45V7.6L10.416 11.075V17.925ZM8.41602 20.225L1.41602 16.2C1.09935 16.0167 0.853516 15.775 0.678516 15.475C0.503516 15.175 0.416016 14.8417 0.416016 14.475V6.525C0.416016 6.15833 0.503516 5.825 0.678516 5.525C0.853516 5.225 1.09935 4.98333 1.41602 4.8L8.41602 0.775C8.73268 0.591667 9.06602 0.5 9.41602 0.5C9.76602 0.5 10.0993 0.591667 10.416 0.775L17.416 4.8C17.7327 4.98333 17.9785 5.225 18.1535 5.525C18.3285 5.825 18.416 6.15833 18.416 6.525V14.475C18.416 14.8417 18.3285 15.175 18.1535 15.475C17.9785 15.775 17.7327 16.0167 17.416 16.2L10.416 20.225C10.0993 20.4083 9.76602 20.5 9.41602 20.5C9.06602 20.5 8.73268 20.4083 8.41602 20.225ZM13.416 7.025L15.341 5.925L9.41602 2.5L7.46602 3.625L13.416 7.025ZM9.41602 9.35L11.366 8.225L5.44102 4.8L3.49102 5.925L9.41602 9.35Z" fill="{% if product.variants.first.available == true %}#258439{% else %}#74797F{% endif %}"/>
          </svg>

          <span style="color: {% if product.variants.first.available == true %}#258439{% else %}#74797F{% endif %};">
            Stock
            {% if product.variants.first.available == true %}
              disponível
            {% else %}
              indisponível
            {% endif %}
          </span>
        </div>
      </div>

      <div id="price_quantity_modal">
        {% if product.variants.first.available == true %}
          <button
            id="add-to-cart"
            data-product-id="{{ product.variants.first.id }}"
          >
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8.52975 17.136C8.52975 17.3274 8.47298 17.5146 8.36661 17.6738C8.26025 17.8329 8.10907 17.957 7.93219 18.0303C7.75531 18.1036 7.56068 18.1227 7.3729 18.0854C7.18513 18.048 7.01265 17.9558 6.87727 17.8204C6.74189 17.6851 6.6497 17.5126 6.61235 17.3248C6.575 17.137 6.59417 16.9424 6.66744 16.7655C6.7407 16.5887 6.86477 16.4375 7.02396 16.3311C7.18315 16.2247 7.3703 16.168 7.56175 16.168C7.81848 16.168 8.06469 16.27 8.24623 16.4515C8.42777 16.633 8.52975 16.8792 8.52975 17.136Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M16.9829 17.136C16.9829 17.3274 16.9261 17.5146 16.8197 17.6738C16.7134 17.8329 16.5622 17.957 16.3853 18.0303C16.2084 18.1036 16.0138 18.1227 15.826 18.0854C15.6383 18.048 15.4658 17.9558 15.3304 17.8204C15.195 17.6851 15.1028 17.5126 15.0655 17.3248C15.0281 17.137 15.0473 16.9424 15.1206 16.7655C15.1938 16.5887 15.3179 16.4375 15.4771 16.3311C15.6363 16.2247 15.8234 16.168 16.0149 16.168C16.2716 16.168 16.5178 16.27 16.6994 16.4515C16.8809 16.633 16.9829 16.8792 16.9829 17.136Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M1 1H4.258L6.441 11.083C6.53024 11.4428 6.74125 11.7605 7.03819 11.9824C7.33513 12.2042 7.69971 12.3164 8.07 12.3H15.987C16.3566 12.3167 16.7207 12.2052 17.0175 11.9843C17.3144 11.7635 17.5258 11.4468 17.616 11.088L18.916 4.77H5.072" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>

            ADICIONAR
          </button>
        {% else %}
          <a
            href="#"
            class="SI_trigger {{ quick_buy_classes }} notify_button_collection"
            style="background-color: #74797F !important;"
            data-product-data="{{ product | json | escape }}"
          >
            <svg
              stroke="currentColor"
              fill="currentColor"
              stroke-width="0"
              viewBox="0 0 448 512"
              height="1.125rem"
              width="1.125rem"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M439.39 362.29c-19.32-20.76-55.47-51.99-55.47-154.29 0-77.7-54.48-139.9-127.94-155.16V32c0-17.67-14.32-32-31.98-32s-31.98 14.33-31.98 32v20.84C118.56 68.1 64.08 130.3 64.08 208c0 102.3-36.15 133.53-55.47 154.29-6 6.45-8.66 14.16-8.61 21.71.11 16.4 12.98 32 32.1 32h383.8c19.12 0 32-15.6 32.1-32 .05-7.55-2.61-15.27-8.61-21.71zM67.53 368c21.22-27.97 44.42-74.33 44.53-159.42 0-.2-.06-.38-.06-.58 0-61.86 50.14-112 112-112s112 50.14 112 112c0 .2-.06.38-.06.58.11 85.1 23.31 131.46 44.53 159.42H67.53zM224 512c35.32 0 63.97-28.65 63.97-64H160.03c0 35.35 28.65 64 63.97 64z"></path>
            </svg>

            NOTIFICAR
          </a>
        {% endif %}
      </div>

      {% if product.variants.first.available == true %}
        <div class="product_delivery_time">
          <svg width="23" height="17" viewBox="0 0 23 17" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6.93677 16.5C6.10343 16.5 5.3951 16.2083 4.81177 15.625C4.22843 15.0417 3.93677 14.3333 3.93677 13.5H1.43677L1.88677 11.5H4.71177C4.9951 11.1833 5.32843 10.9375 5.71177 10.7625C6.0951 10.5875 6.50343 10.5 6.93677 10.5C7.3701 10.5 7.77843 10.5875 8.16177 10.7625C8.5451 10.9375 8.87843 11.1833 9.16177 11.5H13.3368L15.4368 2.5H6.48677L6.91177 0.5H17.9368L17.0118 4.5H19.9368L22.9368 8.5L21.9368 13.5H19.9368C19.9368 14.3333 19.6451 15.0417 19.0618 15.625C18.4784 16.2083 17.7701 16.5 16.9368 16.5C16.1034 16.5 15.3951 16.2083 14.8118 15.625C14.2284 15.0417 13.9368 14.3333 13.9368 13.5H9.93677C9.93677 14.3333 9.6451 15.0417 9.06177 15.625C8.47843 16.2083 7.7701 16.5 6.93677 16.5ZM15.8618 9.5H20.6868L20.7868 8.975L18.9368 6.5H16.5618L15.8618 9.5ZM15.4368 2.5L13.3368 11.5L13.3868 11.325L15.4368 2.5ZM3.43677 9.5V6.5H0.936768L4.43677 1.5V4.5H6.93677L3.43677 9.5ZM6.93677 14.5C7.2201 14.5 7.4576 14.4042 7.64927 14.2125C7.84093 14.0208 7.93677 13.7833 7.93677 13.5C7.93677 13.2167 7.84093 12.9792 7.64927 12.7875C7.4576 12.5958 7.2201 12.5 6.93677 12.5C6.65343 12.5 6.41593 12.5958 6.22427 12.7875C6.0326 12.9792 5.93677 13.2167 5.93677 13.5C5.93677 13.7833 6.0326 14.0208 6.22427 14.2125C6.41593 14.4042 6.65343 14.5 6.93677 14.5ZM16.9368 14.5C17.2201 14.5 17.4576 14.4042 17.6493 14.2125C17.8409 14.0208 17.9368 13.7833 17.9368 13.5C17.9368 13.2167 17.8409 12.9792 17.6493 12.7875C17.4576 12.5958 17.2201 12.5 16.9368 12.5C16.6534 12.5 16.4159 12.5958 16.2243 12.7875C16.0326 12.9792 15.9368 13.2167 15.9368 13.5C15.9368 13.7833 16.0326 14.0208 16.2243 14.2125C16.4159 14.4042 16.6534 14.5 16.9368 14.5Z" fill="#258439"/>
          </svg>

          <div>
            <span style="font-weight: bold;">
              Próximo envio:
              <b class="next_delivery_date"><span class="spinner_date"></span></b>
            </span>

            <span>
              Faça o seu pedido dentro de
              <b class="next_delivery_time"><span class="spinner_date"></span></b>
            </span>
          </div>
        </div>
      {% endif %}
    </aside>
  </section>
</main>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const dateEls = document.querySelectorAll('.next_delivery_date');
    const timeEls = document.querySelectorAll('.next_delivery_time');

    const schedule = () => {
      fullfillDeliveryText(dateEls, timeEls);
      const now = new Date();
      const msToNextMin = (60 - now.getSeconds()) * 1000 - now.getMilliseconds();
      setTimeout(schedule, msToNextMin);
    };

    schedule();
  });
</script>

<main id="product_page_custom_mobile">
  <section class="img_favorite_custom">
    <img
      src="{{ current_image | img_url: 'master' }}"
      alt="{{ product.title }} - imagem principal"
      loading="eager"
      width="auto"
      height="auto"
      id="main-image-product-mobile"
    >

    {% unless product_images.size < 2 %}
      <div>
        {% for image in product_images %}
          <img
            src="{{ image | img_url: 'master' }}"
            alt="{{ product.title }} - imagem {{ forloop.index }}"
            loading="eager"
            width="auto"
            height="auto"
            class="thumbnail-product-mobile"
          >
        {% endfor %}
      </div>
    {% endunless %}
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const thumbnails = document.querySelectorAll('.img_favorite_custom .thumbnail-product-mobile');
      const mainImage = document.getElementById('main-image-product-mobile');

      function setAsMain(event) {
        const novaSrc = event.currentTarget.getAttribute('src');
        mainImage.setAttribute('src', novaSrc);

        const novoAlt = event.currentTarget.getAttribute('alt');
        mainImage.setAttribute('alt', novoAlt);
      }

      thumbnails.forEach(function (thumb) {
        thumb.addEventListener('click', setAsMain);
        thumb.addEventListener('mouseenter', setAsMain);
      });
    });
  </script>

  <div id="product_name_custom">
    <h1>{{ product.title }}</h1>

    {% if vendor_collection != blank %}
      <a class="link_collection" href="{{ vendor_collection.url }}">
        {{- product.vendor -}}
      </a>
    {% else %}
      {% if product.collections.size > 0 %}
        <a class="link_collection" href="/collections/{{ product.collections.first.handle }}">
          {{- product.collections.first.title -}}
        </a>
      {% endif %}
    {% endif %}

    <a href="#custom_reviews_list" class="NETREVIEWS_PRODUCT_STARS" data-product-id="{{ product.id }}"></a>
  </div>

  <aside>
    <div id="price_custom_modal_wrapper">
      <div id="price_custom_modal">
        <h1>{{ product.price | money }}</h1>

        {% if product.compare_at_price > 0 %}
          <span>{{ product.compare_at_price | money }}</span>
        {% endif %}
      </div>

      <a href="#ba-loyalty-home" id="biopoints_wrapper">
        <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M5.63608 14.6456L9.82683 10.4549L5.63608 6.26413C5.07475 5.73633 4.32999 5.4478 3.55959 5.45966C2.78919 5.47151 2.05367 5.78283 1.50885 6.32765C0.964028 6.87247 0.652713 7.60799 0.640855 8.37839C0.628998 9.14879 0.917531 9.89355 1.44533 10.4549C1.15609 10.7268 0.924423 11.0541 0.764068 11.4173C0.603712 11.7805 0.517935 12.1722 0.511826 12.5691C0.505716 12.9661 0.579398 13.3603 0.728501 13.7282C0.877603 14.0962 1.09909 14.4304 1.37982 14.7111C1.66055 14.9919 1.9948 15.2134 2.36275 15.3625C2.7307 15.5116 3.12485 15.5852 3.52181 15.5791C3.91878 15.573 4.31047 15.4872 4.67366 15.3269C5.03684 15.1665 5.36412 14.9349 5.63608 14.6456Z" fill="#258439"/>
          <path d="M10.5129 11.1595L6.32216 15.3502C5.79436 15.9116 5.50583 16.6563 5.51769 17.4267C5.52954 18.1971 5.84086 18.9326 6.38568 19.4775C6.9305 20.0223 7.66602 20.3336 8.43642 20.3455C9.20682 20.3573 9.95158 20.0688 10.5129 19.541C10.7849 19.8302 11.1121 20.0619 11.4753 20.2222C11.8385 20.3826 12.2302 20.4684 12.6272 20.4745C13.0241 20.4806 13.4183 20.4069 13.7862 20.2578C14.1542 20.1087 14.4884 19.8872 14.7692 19.6065C15.0499 19.3258 15.2714 18.9915 15.4205 18.6236C15.5696 18.2556 15.6433 17.8615 15.6372 17.4645C15.631 17.0675 15.5453 16.6758 15.3849 16.3127C15.2246 15.9495 14.9929 15.6222 14.7037 15.3502L10.5129 11.1595Z" fill="#258439"/>
          <path d="M19.5766 6.2611C19.0183 5.7102 18.2655 5.40132 17.4812 5.40132C16.6969 5.40132 15.9441 5.7102 15.3858 6.2611L11.1951 10.4518L15.3858 14.6426C15.6578 14.9318 15.9851 15.1635 16.3482 15.3239C16.7114 15.4842 17.1031 15.57 17.5001 15.5761C17.8971 15.5822 18.2912 15.5085 18.6591 15.3594C19.0271 15.2103 19.3614 14.9888 19.6421 14.7081C19.9228 14.4274 20.1443 14.0931 20.2934 13.7252C20.4425 13.3572 20.5162 12.9631 20.5101 12.5661C20.504 12.1691 20.4182 11.7775 20.2578 11.4143C20.0975 11.0511 19.8658 10.7238 19.5766 10.4518C20.1275 9.89357 20.4363 9.1408 20.4363 8.35647C20.4363 7.57215 20.1275 6.81938 19.5766 6.2611Z" fill="#258439"/>
          <path d="M14.7037 1.38498C14.1454 0.834085 13.3926 0.525208 12.6083 0.525208C11.824 0.525208 11.0712 0.834085 10.5129 1.38498C9.95158 0.857186 9.20682 0.568654 8.43642 0.580511C7.66602 0.592368 6.9305 0.903684 6.38568 1.4485C5.84086 1.99332 5.52954 2.72885 5.51769 3.49925C5.50583 4.26965 5.79436 5.0144 6.32216 5.57573L10.5129 9.76648L14.7037 5.57573C15.2546 5.01745 15.5634 4.26468 15.5634 3.48036C15.5634 2.69603 15.2546 1.94326 14.7037 1.38498Z" fill="#258439"/>
        </svg>

        <span>{{ product.price | money_without_currency | times: 5 }}</span>
      </a>
    </div>

    {%- assign units = product.metafields.PHC['Valor-Unidade'] | floor -%}
    {%- assign pvp = product.price -%}
    {%- assign pvp_per_unit = pvp | divided_by: units | money -%}

    {% if product.compare_at_price > product.price and product.compare_at_price > 0 %}
      <div id="price_percentage_modal">
        <span id="percentage_custom">
          -
          {{-
            product.compare_at_price
            | minus: product.price
            | times: 100.0
            | divided_by: product.compare_at_price
            | round
          -}}
          %</span
        >

        {% unless units == blank
          or product.metafields.PHC['Unidade-Plural'] == blank
          or product.metafields.PHC['Unidade-Singular'] == blank
        %}
          <span>
            {{- units }}
            {{ product.metafields.PHC['Unidade-Plural'] }} / €{{ pvp_per_unit | split: '€' }} por
            {{ product.metafields.PHC['Unidade-Singular'] -}}
          </span>
        {% endunless %}
      </div>
    {% endif %}

    {% if has_tag == true %}
      <div class="discount_badge">
        <span>Preços e campanhas exclusivas da loja online</span>
      </div>

      <ul id="oferta_product_custom">
        {% for block in section.blocks %}
          {% assign current_index = forloop.index %}
          {% assign array_tags = block.settings.selected_tags | split: ',' %}
          {% assign bg_color = block.settings.background_color %}

          {% if bg_color == blank %}
            {% assign idx_mod = current_index | modulo: 2 %}

            {% if idx_mod == 1 %}
              {% assign bg_color = '#ffbb12' %}
            {% else %}
              {% assign bg_color = '#c8e0cd' %}
            {% endif %}
          {% endif %}

          {% for tag in array_tags %}
            {% if product.tags contains tag %}
              <li style="background-color: {{ bg_color }};">
                <div class="title_block_container">
                  <h1>{{ block.settings.selected_title }}</h1>

                  <svg
                    id="get_campaign_details"
                    index="{{ current_index }}"
                    width="21"
                    height="20"
                    viewBox="0 0 21 20"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path d="M9.23096 15H11.231V9H9.23096V15ZM10.231 7C10.5143 7 10.7518 6.90417 10.9435 6.7125C11.1351 6.52083 11.231 6.28333 11.231 6C11.231 5.71667 11.1351 5.47917 10.9435 5.2875C10.7518 5.09583 10.5143 5 10.231 5C9.94762 5 9.71012 5.09583 9.51846 5.2875C9.32679 5.47917 9.23096 5.71667 9.23096 6C9.23096 6.28333 9.32679 6.52083 9.51846 6.7125C9.71012 6.90417 9.94762 7 10.231 7ZM10.231 20C8.84762 20 7.54762 19.7375 6.33096 19.2125C5.11429 18.6875 4.05596 17.975 3.15596 17.075C2.25596 16.175 1.54346 15.1167 1.01846 13.9C0.493457 12.6833 0.230957 11.3833 0.230957 10C0.230957 8.61667 0.493457 7.31667 1.01846 6.1C1.54346 4.88333 2.25596 3.825 3.15596 2.925C4.05596 2.025 5.11429 1.3125 6.33096 0.7875C7.54762 0.2625 8.84762 0 10.231 0C11.6143 0 12.9143 0.2625 14.131 0.7875C15.3476 1.3125 16.406 2.025 17.306 2.925C18.206 3.825 18.9185 4.88333 19.4435 6.1C19.9685 7.31667 20.231 8.61667 20.231 10C20.231 11.3833 19.9685 12.6833 19.4435 13.9C18.9185 15.1167 18.206 16.175 17.306 17.075C16.406 17.975 15.3476 18.6875 14.131 19.2125C12.9143 19.7375 11.6143 20 10.231 20ZM10.231 18C12.4643 18 14.356 17.225 15.906 15.675C17.456 14.125 18.231 12.2333 18.231 10C18.231 7.76667 17.456 5.875 15.906 4.325C14.356 2.775 12.4643 2 10.231 2C7.99762 2 6.10596 2.775 4.55596 4.325C3.00596 5.875 2.23096 7.76667 2.23096 10C2.23096 12.2333 3.00596 14.125 4.55596 15.675C6.10596 17.225 7.99762 18 10.231 18Z" fill="#1C1B1F"/>
                  </svg>
                </div>

                {{- block.settings.selected_description -}}
              </li>
            {% endif %}
          {% endfor %}
        {% endfor %}
      </ul>
    {% endif %}

    <div class="quantity_stock_container">
      <div
        id="quantity-controls"
        style="border: 1px solid {% if product.variants.first.available == true %}#258439{% else %}#C0C5CA{% endif %};"
      >
        <svg
          id="decrease-quantity"
          width="12"
          height="2"
          viewBox="0 0 12 2"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          style="background-color: {% if product.variants.first.available == true %}#b7ffc1{% else %}#C0C5CA{% endif %}; {% if product.variants.first.available == true %}cursor: pointer{% else %}pointer-events: none{% endif %};"
        >
          <path d="M0.657471 1.97195V0.36084H11.9352V1.97195H0.657471Z" fill="{% if product.variants.first.available == true %}black{% else %}white{% endif %}"/>
        </svg>

        {% if product.variants.first.available == true %}
          <input
            type="number"
            id="product-quantity"
            value="1"
            min="1"
            max="16"
          >
        {% else %}
          <span style="color: #C0C5CA;">-</span>
        {% endif %}

        <svg
          id="increase-quantity"
          width="12"
          height="12"
          viewBox="0 0 12 12"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          style="background-color: {% if product.variants.first.available == true %}#b7ffc1{% else %}#C0C5CA{% endif %}; {% if product.variants.first.available == true %}cursor: pointer{% else %}pointer-events: none{% endif %};"
        >
          <path d="M5.34847 6.97179H0.515137V5.36068H5.34847V0.527344H6.95958V5.36068H11.7929V6.97179H6.95958V11.8051H5.34847V6.97179Z" fill="{% if product.variants.first.available == true %}black{% else %}white{% endif %}"/>
        </svg>
      </div>

      <div class="stock_container">
        <svg width="19" height="21" viewBox="0 0 19 21" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M8.41602 17.925V11.075L2.41602 7.6V14.45L8.41602 17.925ZM10.416 17.925L16.416 14.45V7.6L10.416 11.075V17.925ZM8.41602 20.225L1.41602 16.2C1.09935 16.0167 0.853516 15.775 0.678516 15.475C0.503516 15.175 0.416016 14.8417 0.416016 14.475V6.525C0.416016 6.15833 0.503516 5.825 0.678516 5.525C0.853516 5.225 1.09935 4.98333 1.41602 4.8L8.41602 0.775C8.73268 0.591667 9.06602 0.5 9.41602 0.5C9.76602 0.5 10.0993 0.591667 10.416 0.775L17.416 4.8C17.7327 4.98333 17.9785 5.225 18.1535 5.525C18.3285 5.825 18.416 6.15833 18.416 6.525V14.475C18.416 14.8417 18.3285 15.175 18.1535 15.475C17.9785 15.775 17.7327 16.0167 17.416 16.2L10.416 20.225C10.0993 20.4083 9.76602 20.5 9.41602 20.5C9.06602 20.5 8.73268 20.4083 8.41602 20.225ZM13.416 7.025L15.341 5.925L9.41602 2.5L7.46602 3.625L13.416 7.025ZM9.41602 9.35L11.366 8.225L5.44102 4.8L3.49102 5.925L9.41602 9.35Z" fill="{% if product.variants.first.available == true %}#258439{% else %}#74797F{% endif %}"/>
        </svg>

        <span style="color: {% if product.variants.first.available == true %}#258439{% else %}#74797F{% endif %};">
          Stock
          {% if product.variants.first.available == true %}
            disponível
          {% else %}
            indisponível
          {% endif %}
        </span>
      </div>
    </div>

    <div id="price_quantity_modal">
      {% if product.variants.first.available == true %}
        <button
          id="add-to-cart"
          data-product-id="{{ product.variants.first.id }}"
        >
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8.52975 17.136C8.52975 17.3274 8.47298 17.5146 8.36661 17.6738C8.26025 17.8329 8.10907 17.957 7.93219 18.0303C7.75531 18.1036 7.56068 18.1227 7.3729 18.0854C7.18513 18.048 7.01265 17.9558 6.87727 17.8204C6.74189 17.6851 6.6497 17.5126 6.61235 17.3248C6.575 17.137 6.59417 16.9424 6.66744 16.7655C6.7407 16.5887 6.86477 16.4375 7.02396 16.3311C7.18315 16.2247 7.3703 16.168 7.56175 16.168C7.81848 16.168 8.06469 16.27 8.24623 16.4515C8.42777 16.633 8.52975 16.8792 8.52975 17.136Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M16.9829 17.136C16.9829 17.3274 16.9261 17.5146 16.8197 17.6738C16.7134 17.8329 16.5622 17.957 16.3853 18.0303C16.2084 18.1036 16.0138 18.1227 15.826 18.0854C15.6383 18.048 15.4658 17.9558 15.3304 17.8204C15.195 17.6851 15.1028 17.5126 15.0655 17.3248C15.0281 17.137 15.0473 16.9424 15.1206 16.7655C15.1938 16.5887 15.3179 16.4375 15.4771 16.3311C15.6363 16.2247 15.8234 16.168 16.0149 16.168C16.2716 16.168 16.5178 16.27 16.6994 16.4515C16.8809 16.633 16.9829 16.8792 16.9829 17.136Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M1 1H4.258L6.441 11.083C6.53024 11.4428 6.74125 11.7605 7.03819 11.9824C7.33513 12.2042 7.69971 12.3164 8.07 12.3H15.987C16.3566 12.3167 16.7207 12.2052 17.0175 11.9843C17.3144 11.7635 17.5258 11.4468 17.616 11.088L18.916 4.77H5.072" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>

          ADICIONAR
        </button>
      {% else %}
        <a
          href="#"
          class="SI_trigger {{ quick_buy_classes }} notify_button_collection"
          style="background-color: #74797F !important;"
          data-product-data="{{ product | json | escape }}"
        >
          <svg
            stroke="currentColor"
            fill="currentColor"
            stroke-width="0"
            viewBox="0 0 448 512"
            height="1.125rem"
            width="1.125rem"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path d="M439.39 362.29c-19.32-20.76-55.47-51.99-55.47-154.29 0-77.7-54.48-139.9-127.94-155.16V32c0-17.67-14.32-32-31.98-32s-31.98 14.33-31.98 32v20.84C118.56 68.1 64.08 130.3 64.08 208c0 102.3-36.15 133.53-55.47 154.29-6 6.45-8.66 14.16-8.61 21.71.11 16.4 12.98 32 32.1 32h383.8c19.12 0 32-15.6 32.1-32 .05-7.55-2.61-15.27-8.61-21.71zM67.53 368c21.22-27.97 44.42-74.33 44.53-159.42 0-.2-.06-.38-.06-.58 0-61.86 50.14-112 112-112s112 50.14 112 112c0 .2-.06.38-.06.58.11 85.1 23.31 131.46 44.53 159.42H67.53zM224 512c35.32 0 63.97-28.65 63.97-64H160.03c0 35.35 28.65 64 63.97 64z"></path>
          </svg>

          NOTIFICAR
        </a>
      {% endif %}
    </div>

    {% if product.variants.first.available == true %}
      <div class="product_delivery_time">
        <svg width="23" height="17" viewBox="0 0 23 17" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6.93677 16.5C6.10343 16.5 5.3951 16.2083 4.81177 15.625C4.22843 15.0417 3.93677 14.3333 3.93677 13.5H1.43677L1.88677 11.5H4.71177C4.9951 11.1833 5.32843 10.9375 5.71177 10.7625C6.0951 10.5875 6.50343 10.5 6.93677 10.5C7.3701 10.5 7.77843 10.5875 8.16177 10.7625C8.5451 10.9375 8.87843 11.1833 9.16177 11.5H13.3368L15.4368 2.5H6.48677L6.91177 0.5H17.9368L17.0118 4.5H19.9368L22.9368 8.5L21.9368 13.5H19.9368C19.9368 14.3333 19.6451 15.0417 19.0618 15.625C18.4784 16.2083 17.7701 16.5 16.9368 16.5C16.1034 16.5 15.3951 16.2083 14.8118 15.625C14.2284 15.0417 13.9368 14.3333 13.9368 13.5H9.93677C9.93677 14.3333 9.6451 15.0417 9.06177 15.625C8.47843 16.2083 7.7701 16.5 6.93677 16.5ZM15.8618 9.5H20.6868L20.7868 8.975L18.9368 6.5H16.5618L15.8618 9.5ZM15.4368 2.5L13.3368 11.5L13.3868 11.325L15.4368 2.5ZM3.43677 9.5V6.5H0.936768L4.43677 1.5V4.5H6.93677L3.43677 9.5ZM6.93677 14.5C7.2201 14.5 7.4576 14.4042 7.64927 14.2125C7.84093 14.0208 7.93677 13.7833 7.93677 13.5C7.93677 13.2167 7.84093 12.9792 7.64927 12.7875C7.4576 12.5958 7.2201 12.5 6.93677 12.5C6.65343 12.5 6.41593 12.5958 6.22427 12.7875C6.0326 12.9792 5.93677 13.2167 5.93677 13.5C5.93677 13.7833 6.0326 14.0208 6.22427 14.2125C6.41593 14.4042 6.65343 14.5 6.93677 14.5ZM16.9368 14.5C17.2201 14.5 17.4576 14.4042 17.6493 14.2125C17.8409 14.0208 17.9368 13.7833 17.9368 13.5C17.9368 13.2167 17.8409 12.9792 17.6493 12.7875C17.4576 12.5958 17.2201 12.5 16.9368 12.5C16.6534 12.5 16.4159 12.5958 16.2243 12.7875C16.0326 12.9792 15.9368 13.2167 15.9368 13.5C15.9368 13.7833 16.0326 14.0208 16.2243 14.2125C16.4159 14.4042 16.6534 14.5 16.9368 14.5Z" fill="#258439"/>
        </svg>

        <div>
          <span style="font-weight: bold;">
            Próximo envio:
            <b class="next_delivery_date"><span class="spinner_date"></span></b>
          </span>

          <span>
            Faça o seu pedido dentro de
            <b class="next_delivery_time"><span class="spinner_date"></span></b>
          </span>
        </div>
      </div>
    {% endif %}
  </aside>

  <ul id="product_description_custom">
    {% if indicacoes != blank %}
      <li>
        <h2>Indicações</h2>

        <span id="indicacoes_list_custom">{{ indicacoes }}</span>
      </li>
    {% endif %}

    {% if descricao != blank %}
      <li>
        <h2>Descrição</h2>

        <span>{{ descricao }}</span>
      </li>
    {% endif %}

    {% if utilizacao != blank %}
      <li>
        <h2>Modo de Utilização</h2>

        <span>{{ utilizacao }}</span>
      </li>
    {% endif %}

    {% if composicao_nutricional != blank %}
      <li>
        <h2>Composição Nutricional</h2>

        <span>{{ composicao_nutricional }}</span>
      </li>
    {% endif %}

    {% if ingredientes != blank %}
      <li>
        <h2>Ingredientes</h2>

        <span>{{ ingredientes }}</span>
      </li>
    {% endif %}

    {% if advertencias != blank %}
      <li>
        <h2>Advertências</h2>

        <span>{{ advertencias }}</span>
      </li>
    {% endif %}

    <li>
      <h2>Disclaimer</h2>

      {{ section.settings.disclamer_text }}
    </li>
  </ul>
</main>

<div id="custom_reviews_list" class="NETREVIEWS_PRODUCT_REVIEWS" data-product-id="{{ product.id }}"></div>

<div id="related_products_custom">
  <h1>Também poderá gostar</h1>

  <ul>
    <li>
      <svg xmlns="http://www.w3.org/2000/svg" height="12" width="7.5" viewBox="0 0 320 512">
        <path fill="#ffffff" d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/>
      </svg>
    </li>

    {% assign brand_related = collections[product.vendor] %}
    {% if brand_related.products.size > 0 %}
      {% for p in brand_related.products limit: 12 %}
        <li>
          {% render 'product-item-2', product: p %}
        </li>
      {% endfor %}
    {% else %}
      {% for p in product.collections.first.products limit: 12 %}
        <li>
          {% render 'product-item-2', product: p %}
        </li>
      {% endfor %}
    {% endif %}

    <li>
      <svg xmlns="http://www.w3.org/2000/svg" height="12" width="7.5" viewBox="0 0 320 512" id="right-button-svg">
        <path fill="#ffffff" d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/>
      </svg>
    </li>
  </ul>
</div>

{% for block in section.blocks %}
  {% assign current_index = forloop.index %}
  {% assign array_tags = block.settings.selected_tags | split: ',' %}

  {% for tag in array_tags %}
    {% if product.tags contains tag %}
      {% assign block_has_tag = true %}
      {% break %}
    {% endif %}
  {% endfor %}

  {% if block_has_tag == true %}
    <section id="modal_campaign_details" index="{{ current_index }}">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        height="14"
        width="10.5"
        viewBox="0 0 384 512"
        id="escape_modal"
        index="{{ current_index }}"
      >
        <path fill="#258439" d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"/>
      </svg>

      <div>
        <svg width="39" height="35" viewBox="0 0 39 35" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M26.2727 0.55475L36.0079 10.6563C37.9248 12.6443 39 15.3277 39 18.1241C39 20.9204 37.9248 23.6038 36.0079 25.5918L27.4791 34.4425C27.3106 34.6176 27.1101 34.757 26.8891 34.8526C26.6681 34.9483 26.4309 34.9983 26.1911 35C25.9512 35.0016 25.7134 34.9547 25.4912 34.862C25.2691 34.7694 25.0668 34.6327 24.8961 34.4599C24.5514 34.1108 24.3559 33.6355 24.3527 33.1386C24.3512 32.8925 24.3968 32.6486 24.4872 32.4206C24.5775 32.1927 24.7107 31.9852 24.8792 31.8101L33.4002 22.9595C34.6407 21.6732 35.3366 19.9368 35.3366 18.1274C35.3366 16.318 34.6407 14.5816 33.4002 13.2953L23.6755 3.19515C23.3352 2.84147 23.1458 2.36361 23.149 1.86669C23.1522 1.36977 23.3476 0.894493 23.6924 0.545415C24.0372 0.196338 24.503 0.00205499 24.9874 0.0053061C25.4718 0.00855722 25.9351 0.209076 26.2753 0.562751L26.2727 0.55475ZM1.11654e-05 15.429V3.7499C0.000355705 2.75547 0.385586 1.80188 1.07103 1.09871C1.75647 0.395544 2.68603 0.000353463 3.65539 1.45017e-08H15.0401C15.6809 -5.004e-05 16.3155 0.129478 16.9074 0.381178C17.4994 0.632878 18.0372 1.00181 18.4901 1.46689L31.2839 14.5915C32.1975 15.5288 32.7106 16.8 32.7106 18.1254C32.7106 19.4508 32.1975 20.722 31.2839 21.6593L21.1173 32.0848C20.2036 33.022 18.9645 33.5484 17.6725 33.5484C16.3804 33.5484 15.1413 33.022 14.2277 32.0848L1.42993 18.9602C0.975595 18.498 0.615247 17.9479 0.369786 17.3417C0.124324 16.7355 -0.00136413 16.0854 1.11654e-05 15.429ZM10.9662 8.74932C10.9662 8.25479 10.8232 7.77137 10.5554 7.36018C10.2876 6.949 9.90691 6.62852 9.46154 6.43927C9.01617 6.25002 8.5261 6.20051 8.0533 6.29698C7.5805 6.39346 7.1462 6.6316 6.80533 6.98128C6.46446 7.33097 6.23233 7.77649 6.13828 8.26152C6.04423 8.74654 6.0925 9.24928 6.27698 9.70617C6.46146 10.1631 6.77386 10.5536 7.17468 10.8283C7.5755 11.103 8.04674 11.2497 8.5288 11.2497C9.17523 11.2497 9.79518 10.9863 10.2523 10.5173C10.7094 10.0484 10.9662 9.41246 10.9662 8.74932Z" fill="#258439"/>
        </svg>

        <div>
          <h1>Mais info</h1>

          {% if block.settings.selected_modal_description %}
            <span>{{ block.settings.selected_modal_description }}</span>
          {% endif %}
        </div>
      </div>
    </section>
  {% endif %}
{% endfor %}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const onResize = () => {
      const getElements = document.querySelectorAll('#get_campaign_details');

      if (getElements) {
        getElements.forEach((element) => {
          element.addEventListener('click', function () {
            const elementIndex = element.getAttribute('index');
            const modalElement = Array.from(document.querySelectorAll('#modal_campaign_details')).find(
              (el) => el.getAttribute('index') === elementIndex
            );
            const overlayElement = document.querySelector('#modal_overlay');

            overlayElement.style.display = 'block';

            if (window.innerWidth > 1000) {
              modalElement.style.display = 'grid';
            } else {
              modalElement.style.transform = 'translateY(0)';
            }

            overlayElement.addEventListener('click', function () {
              overlayElement.style.display = 'none';

              if (window.innerWidth > 1000) {
                const modalCruz = document.querySelectorAll('#modal_form_cruz');

                if (modalCruz && modalCruz.style.visibility === 'visible') {
                  modalCruz.style.opacity = 0;
                  modalCruz.style.visibility = 'hidden';
                }

                modalElement.style.display = 'none';
              } else {
                modalElement.style.transform = 'translateY(100%)';
              }
            });
          });
        });
      }

      const escapeElements = document.querySelectorAll('#escape_modal');

      if (escapeElements) {
        escapeElements.forEach((element) => {
          element.addEventListener('click', function () {
            const elementIndex = element.getAttribute('index');
            const modalElement = Array.from(document.querySelectorAll('#modal_campaign_details')).find(
              (el) => el.getAttribute('index') === elementIndex
            );
            const overlayElement = document.querySelector('#modal_overlay');

            overlayElement.style.display = 'none';

            if (window.innerWidth > 1000) {
              modalElement.style.display = 'none';
            } else {
              modalElement.style.transform = 'translateY(100%)';
            }
          });
        });
      }
    };

    onResize();

    window.addEventListener('resize', onResize);
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const quantityInput = document.querySelectorAll('#product-quantity');
    const decreaseButton = document.querySelectorAll('#decrease-quantity');
    const increaseButton = document.querySelectorAll('#increase-quantity');
    const addToCartButton = document.querySelectorAll('#add-to-cart');

    const updateQuantity = (delta) => {
      const currentValue = parseInt(quantityInput[0].value, 10) || 1;
      const newValue = Math.max(1, currentValue + delta);
      quantityInput.forEach((input) => (input.value = newValue));
    };

    decreaseButton.forEach((input) => input.addEventListener('click', () => updateQuantity(-1)));
    increaseButton.forEach((input) => input.addEventListener('click', () => updateQuantity(1)));

    const loader = document.getElementById('loader');

    function showLoader() {
      loader.style.display = 'block';
      loader.style.width = '0%';

      setTimeout(() => {
        loader.style.width = '30%';
      }, 100);
    }

    function hideLoader() {
      loader.style.width = '100%';

      setTimeout(() => {
        loader.style.display = 'none';
        loader.style.width = '0%';
      }, 400);
    }

    addToCartButton.forEach((cart) => {
      cart.addEventListener('click', () => {
        const productId = cart.getAttribute('data-product-id');
        const quantity = parseInt(quantityInput[0].value, 10) || 1;

        if (!productId) {
          return;
        }

        showLoader();

        fetch(`/cart/add.js`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ id: productId, quantity: quantity }),
        })
          .then((response) => {
            if (!response.ok) {
              return response.json().then((data) => {
                throw new Error(data.message || 'Erro ao adicionar ao carrinho.');
              });
            }

            fetch(`/cart?view=mini-cart&timestamp=${Date.now()}`)
              .then((res) => {
                if (!res.ok) {
                  throw new Error('Erro ao obter carrinho');
                }

                return res.text();
              })
              .then((data) => {
                if (data) {
                  const carts = document.querySelectorAll('#mini-cart');

                  if (carts) {
                    carts.forEach((cart) => (cart.innerHTML = data));

                    if (innerWidth >= 2559) {
                      carts.forEach((cart) => (cart.style.marginRight = '17vw'));
                    }

                    if (innerWidth < 2559 && innerWidth >= 1499) {
                      carts.forEach((cart) => (cart.style.marginRight = '8vw'));
                    }

                    if (innerWidth < 1499 && innerWidth >= 1000) {
                      carts.forEach((cart) => (cart.style.marginRight = '2vw'));
                    }

                    if (innerWidth >= 1000) {
                      carts.forEach((cart) => (cart.style.top = '4.85rem'));
                    }

                    if (innerWidth < 1000) {
                      carts.forEach((cart) => {
                        cart.style.transform = 'scale(1)';
                        cart.style.maxHeight = 'calc(100vh - 40px)';
                        cart.style.padding = '1rem 1rem 2rem 1rem';
                      });

                      const as = carts.forEach((cart) => cart.querySelector('a'));

                      if (as) {
                        as.forEach((a) => (a.style.padding = '0 1rem'));
                      }
                    } else {
                      carts.forEach((cart) => {
                        cart.style.visibility = 'visible';
                        cart.style.opacity = 1;
                      });
                    }
                  }

                  return fetch('/cart.js');
                }
              })
              .then((res) => {
                if (!res.ok) {
                  throw new Error('Error while fetching cart');
                }

                return res.json();
              })
              .then((data) => {
                if (data) {
                  const cartCounters = document.querySelectorAll('.header__cart-count');

                  if (cartCounters) {
                    cartCounters.forEach((cart) => (cart.innerText = data.item_count));
                  }
                }
              })
              .catch((error) => {
                console.error('Error when getting cart');
              });
          })
          .catch((error) => {
            console.error('Erro ao adicionar ao carrinho:', error);
            alert(error.message || 'Erro ao adicionar ao carrinho.');
          })
          .finally(() => hideLoader());
      });
    });
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const productsContainer = document.querySelector('#related_products_custom ul');
    const leftButton = document.querySelector('#related_products_custom ul li:first-child svg');
    const rightButton = document.querySelector('#related_products_custom ul li:last-child svg');

    if (!productsContainer || !leftButton || !rightButton) return;

    const updateLayout = () => {
      if (window.innerWidth > 1000) {
        leftButton.style.display = 'block';
        rightButton.style.display = 'block';

        const productWidth = productsContainer.offsetWidth / 4;
        const itemsPerPage = 4;
        productsContainer.style.scrollBehavior = 'smooth';

        leftButton.onclick = () => {
          productsContainer.scrollLeft -= productWidth * itemsPerPage;
        };

        rightButton.onclick = () => {
          productsContainer.scrollLeft += productWidth * itemsPerPage;
        };
      } else {
        leftButton.style.display = 'none';
        rightButton.style.display = 'none';
      }
    };

    updateLayout();

    window.addEventListener('resize', updateLayout);
  });
</script>
